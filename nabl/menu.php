<?php
$filing_names = basename($_SERVER["SCRIPT_FILENAME"], '.php');

if ($filing_names == "client_form") {
	$client_form = "btn-warning";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "job_listing_for_second_reception") {
	$client_form = "btn-primary";
	$mat_sel = "btn-warning";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_completed_job_report_for_reception") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-warning";
	$arivse = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "progress_job_list_for_rec") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$progress = "btn-warning";
	$arivse = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_dispatched_report_for_reception") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-warning";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "view_job_invert_register_for_rec") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-warning";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "job_listing_for_engineer") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-warning";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "due_job_listing_for_engineer") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-warning";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_completed_jobs_work_for_engineer_to_view") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-warning";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_job_report_for_qm") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-warning";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_completed_job_report_for_qm") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-warning";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "delivery_data") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-warning";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_job_report_for_biller") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-warning";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "list_of_completed_perfoma_for_biller") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-warning";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "sel_report_by_search") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-warning";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
} else if ($filing_names == "un_dispatched_reports_for_rec") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-warning";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "un_scanned_jobs") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-warning";
	$mails = "btn-primary";
	$task = "btn-primary";
} else if ($filing_names == "scanned_list") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-warning";
	$task = "btn-primary";
} else if ($filing_names == "task_asigner") {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-warning";
} else {
	$client_form = "btn-primary";
	$mat_sel = "btn-primary";
	$mat_complte = "btn-primary";
	$dispathed = "btn-primary";
	$inv_reg = "btn-primary";
	$list_eng = "btn-primary";
	$list_eng_due = "btn-primary";
	$j_for_e_view = "btn-primary";
	$list_f_qm = "btn-primary";
	$list_compl_qm = "btn-primary";
	$delivery_data = "btn-primary";
	$arivse = "btn-primary";
	$pending_biller = "btn-primary";
	$p_lists = "btn-primary";
	$inv_list = "btn-primary";
	$progress = "btn-primary";
	$by_search = "btn-primary";
	$un_dispathed = "btn-primary";
	$scanned = "btn-primary";
	$mails = "btn-primary";
	$task = "btn-primary";
}
?>

<?php

// Check if a session is not already started and start one.
if (session_status() === PHP_SESSION_NONE) {
	session_start();
}

// Get the current page filename without the .php extension.
$current_page = basename($_SERVER["SCRIPT_FILENAME"], '.php');

// Define the base classes for all buttons.
$base_btn_class = 'menu-btn';

// Define the class for the active page, default is empty.
$active_class = 'active';

// Set active classes for different user roles.
$menu_items = [];

// Initialize an empty string for the menu content.
$menu_content = '';

// Check the user's admin level and build the menu content accordingly.
if (isset($_SESSION['isadmin'])) {
	switch ($_SESSION['isadmin']) {
		case 0:
			// Admin role
			$menu_items = [
				'dashboard' => ['href' => 'dashboard.php', 'title' => 'Dashboard'],
				'master_forms' => ['href' => 'master_forms.php', 'title' => 'Master Form'],
			];
			break;
		case 2:
			// Reception/CSC role
			$menu_items = [
				'dashboard' => ['href' => 'dashboard.php', 'title' => 'Dashboard'],
				'client_form' => ['href' => 'client_form.php', 'title' => 'Inward'],
				'job_listing_for_second_reception' => ['href' => 'job_listing_for_second_reception.php', 'title' => 'Material Selection'],
				'list_of_completed_job_report_for_reception' => ['href' => 'list_of_completed_job_report_for_reception.php', 'title' => 'Completed Job List'],
				'un_dispatched_reports_for_rec' => ['href' => 'un_dispatched_reports_for_rec.php', 'title' => 'Undispatch List'],
				'list_of_dispatched_report_for_reception' => ['href' => 'list_of_dispatched_report_for_reception.php', 'title' => 'Dispatch List'],
				'view_job_invert_register_for_rec' => ['href' => 'view_job_invert_register_for_rec.php', 'title' => 'Inward Register'],
				'ulr_listing' => ['href' => 'ulr_listing.php', 'title' => 'Ulr List'],
			];
			// Add notifications for specific pages
			// This is just a placeholder logic, you will need to adapt it.
			if ($current_page == 'list_of_completed_job_report_for_reception') {
				$notif_query = "SELECT COUNT(*) as new_jobs FROM job WHERE live_status IN (6,7) AND print_done_by_biller_for_qm_see!=1";
				$result = mysqli_query($conn, $notif_query);
				if ($result) {
					$row = mysqli_fetch_assoc($result);
					if ($row['new_jobs'] > 0) {
						$menu_items['list_of_completed_job_report_for_reception']['notification'] = $row['new_jobs'];
					}
				}
			}
			break;
		case 4:
			// Engineer role
			$menu_items = [
				'dashboard' => ['href' => 'dashboard.php', 'title' => 'Dashboard'],
				'arrival_jobs_list_from_tm_to_eng' => ['href' => 'arrival_jobs_list_from_tm_to_eng.php', 'title' => 'Arrival Job'],
				'reward_job_for_engineer' => ['href' => 'reward_job_for_engineer.php', 'title' => 'Reward Jobs'],
				'job_listing_for_engineer' => ['href' => 'job_listing_for_engineer.php', 'title' => 'Job List'],
				'list_of_completed_jobs_work_for_engineer_to_view' => ['href' => 'list_of_completed_jobs_work_for_engineer_to_view.php', 'title' => 'Completed Job List'],
				'task_asigner' => ['href' => 'task_asigner.php', 'title' => 'Tasks'],
			];
			// Add notifications for specific pages
			if ($current_page == 'arrival_jobs_list_from_tm_to_eng' || $current_page == 'reward_job_for_engineer' || $current_page == 'list_of_completed_jobs_work_for_engineer_to_view') {
				$user_id = $_SESSION['u_id'];
				$notif_query = "SELECT tested_by FROM job WHERE live_status IN (2, 4, 6)";
				$result = mysqli_query($conn, $notif_query);
				if ($result) {
					$new_jobs = 0;
					while ($row = mysqli_fetch_assoc($result)) {
						$explode_tested_by = explode(",", $row["tested_by"]);
						if (in_array($user_id, $explode_tested_by)) {
							$new_jobs++;
						}
					}
					if ($new_jobs > 0) {
						// This logic needs to be refined for specific pages, but this is a start.
						if ($current_page == 'arrival_jobs_list_from_tm_to_eng') {
							$menu_items['arrival_jobs_list_from_tm_to_eng']['notification'] = $new_jobs;
						} elseif ($current_page == 'reward_job_for_engineer') {
							$menu_items['reward_job_for_engineer']['notification'] = $new_jobs;
						} elseif ($current_page == 'list_of_completed_jobs_work_for_engineer_to_view') {
							$menu_items['list_of_completed_jobs_work_for_engineer_to_view']['notification'] = $new_jobs;
						}
					}
				}
			}
			break;
		case 11:
			// This is a placeholder for `isadmin` == 11. Your original code only shows links without any dynamic notifications, so this reflects that.
			$menu_items = [
				'arrival_jobs_list_from_rec_to_tm' => ['href' => 'arrival_jobs_list_from_rec_to_tm.php', 'title' => 'Arrival Jobs From CSC'],
				'arrival_jobs_list_from_eng_to_to_for_verify' => ['href' => 'arrival_jobs_list_from_eng_to_to_for_verify.php', 'title' => 'Arrival Jobs From Eng For Verify'],
				'arrival_jobs_list_from_qm_completed' => ['href' => 'arrival_jobs_list_from_qm_completed.php', 'title' => 'Arrival Jobs From SA'],
			];
			break;
		case 5:
			// Quality Manager (QM) role
			$menu_items = [
				'dashboard' => ['href' => 'dashboard.php', 'title' => 'Dashboard'],
				'arrival_jobs_list_from_rec_to_tm' => ['href' => 'arrival_jobs_list_from_rec_to_tm.php', 'title' => 'Arrival Job'],
				'list_of_job_report_for_qm' => ['href' => 'list_of_job_report_for_qm.php', 'title' => 'Job For Verification'],
				'list_of_job_report_for_auth' => ['href' => 'list_of_job_report_for_auth.php', 'title' => 'Job For Authorization'],
				'list_of_completed_job_report_for_qm' => ['href' => 'list_of_completed_job_report_for_qm.php', 'title' => 'Completed Job List'],
				'sel_report_by_search' => ['href' => 'sel_report_by_search.php', 'title' => 'Report List'],
				'task_asigner' => ['href' => 'task_asigner.php', 'title' => 'Tasks'],
			];
			// Add notifications for specific pages
			if ($current_page == 'arrival_jobs_list_from_rec_to_tm') {
				$notif_query = "SELECT reported_by FROM job WHERE live_status = 1";
				$result = mysqli_query($conn, $notif_query);
				if ($result) {
					$new_jobs = 0;
					while ($row = mysqli_fetch_assoc($result)) {
						$reported_by_users = explode(",", $row["reported_by"]);
						if (in_array($_SESSION['u_id'], $reported_by_users)) {
							$new_jobs++;
						}
					}
					if ($new_jobs > 0) {
						$menu_items['arrival_jobs_list_from_rec_to_tm']['notification'] = $new_jobs;
					}
				}
			}
			if ($current_page == 'list_of_job_report_for_qm') {
				$notif_query = "SELECT reported_by_review FROM job WHERE live_status = 3";
				$result = mysqli_query($conn, $notif_query);
				if ($result) {
					$new_jobs = 0;
					while ($row = mysqli_fetch_assoc($result)) {
						$reported_by_review_users = explode(",", $row["reported_by_review"]);
						if (in_array($_SESSION['u_id'], $reported_by_review_users)) {
							$new_jobs++;
						}
					}
					if ($new_jobs > 0) {
						$menu_items['list_of_job_report_for_qm']['notification'] = $new_jobs;
					}
				}
			}
			if ($current_page == 'list_of_job_report_for_auth') {
				$notif_query = "SELECT reported_by_authorize FROM job WHERE live_status = 5";
				$result = mysqli_query($conn, $notif_query);
				if ($result) {
					$new_jobs = 0;
					while ($row = mysqli_fetch_assoc($result)) {
						$reported_by_authorize_users = explode(",", $row["reported_by_authorize"]);
						if (in_array($_SESSION['u_id'], $reported_by_authorize_users)) {
							$new_jobs++;
						}
					}
					if ($new_jobs > 0) {
						$menu_items['list_of_job_report_for_auth']['notification'] = $new_jobs;
					}
				}
			}
			if ($current_page == 'list_of_completed_job_report_for_qm') {
				$notif_query = "SELECT reported_by_authorize FROM job WHERE live_status = 6";
				$result = mysqli_query($conn, $notif_query);
				if ($result) {
					$new_jobs = 0;
					while ($row = mysqli_fetch_assoc($result)) {
						$reported_by_authorize_users = explode(",", $row["reported_by_authorize"]);
						if (in_array($_SESSION['u_id'], $reported_by_authorize_users)) {
							$new_jobs++;
						}
					}
					if ($new_jobs > 0) {
						$menu_items['list_of_completed_job_report_for_qm']['notification'] = $new_jobs;
					}
				}
			}
			break;
		case 6:
			// Biller/Accounts role
			$menu_items = [
				'agency' => ['href' => 'agency.php', 'title' => 'Agency List'],
				'view_customer_lists' => ['href' => 'view_customer_lists.php', 'title' => 'Client List'],
				'list_of_job_report_for_biller' => ['href' => 'list_of_job_report_for_biller.php', 'title' => 'Arrival Job List'],
				'list_of_completed_perfoma_for_biller' => ['href' => 'list_of_completed_perfoma_for_biller.php', 'title' => 'Pending Invoice List'],
				'list_of_completed_perfoma_only_view_for_biller' => ['href' => 'list_of_completed_perfoma_only_view_for_biller.php', 'title' => 'Proforma List'],
				'list_of_final_bill_by_biller' => ['href' => 'list_of_final_bill_by_biller.php', 'title' => 'Invoice List'],
				'list_of_estimate_biller' => ['href' => 'list_of_estimate_biller.php', 'title' => 'Estimate List'],
				'voucher_list' => ['href' => 'voucher_list.php', 'title' => 'Voucher List'],
				'receipt_list' => ['href' => 'receipt_list.php', 'title' => 'Payment In'],
				'cash_receipt_list' => ['href' => 'cash_receipt_list.php', 'title' => 'Cash Payment In'],
				'purchage_list' => ['href' => 'purchage_list.php', 'title' => 'Purchase In List'],
				'purchage_list_out' => ['href' => 'purchage_list_out.php', 'title' => 'Payment Out List'],
				'gst_register' => ['href' => 'gst_register.php', 'title' => 'Gst Register'],
				'ledger_list' => ['href' => 'ledger_list.php', 'title' => 'Ledger'],
				'purchase_ledger_list' => ['href' => 'purchase_ledger_list.php', 'title' => 'Purchase Ledger'],
				'list_of_quoations' => ['href' => 'list_of_quoations.php', 'title' => 'Quotation'],
				'task_asigner' => ['href' => 'task_asigner.php', 'title' => 'Tasks'],
			];
			break;
		case 9:
			// Manager role
			$menu_items = [
				'arrival_jobs_list_from_rec_to_tm' => ['href' => 'arrival_jobs_list_from_rec_to_tm.php', 'title' => 'Arrival Jobs From CSC'],
				'list_of_job_report_for_qm' => ['href' => 'list_of_job_report_for_qm.php', 'title' => 'Job List'],
				'list_of_completed_job_report_for_qm' => ['href' => 'list_of_completed_job_report_for_qm.php', 'title' => 'Completed Job List'],
				'sel_report_by_search' => ['href' => 'sel_report_by_search.php', 'title' => 'Report List'],
				'task_asigner' => ['href' => 'task_asigner.php', 'title' => 'Tasks'],
			];
			break;
		case 888:
			// Deleter role
			$menu_items = [
				'list_of_completed_job_report_for_deleter' => ['href' => 'list_of_completed_job_report_for_deleter.php', 'title' => 'Job List'],
			];
			break;
		default:
			break;
	}
}

// Generate the menu links
foreach ($menu_items as $filename => $item) {
	$link_class = ($current_page == $filename) ? "$base_btn_class $active_class" : $base_btn_class;
	$notification_badge = '';
	if (isset($item['notification']) && $item['notification'] > 0) {
		$notification_badge = "<span class='notification-badge'>{$item['notification']}</span>";
	}
	$menu_content .= "<a class='{$link_class}' href='{$item['href']}' title='{$item['title']}'>{$item['title']}{$notification_badge}</a>";
}

// Fetch user data for the profile dropdown.
$user_data = ['staff_fullname' => 'Guest', 'staff_email' => 'N/A', 'staff_contactno' => 'N/A'];
if (isset($_SESSION['u_id'])) {
	$user_id = $_SESSION['u_id'];
	$table = (isset($_SESSION['nabl_type']) && $_SESSION['nabl_type'] == "blank") ? "staff" : "multi_login";
	$query = "SELECT staff_fullname, staff_email, staff_contactno FROM {$table} WHERE `id` = '{$user_id}'";
	$result = mysqli_query($conn, $query);
	if ($result && mysqli_num_rows($result) > 0) {
		$user_data = mysqli_fetch_array($result);
	}
}
?>

<link rel="stylesheet" href="style/menu_styles.css">

<div class="menu-container">
	<div class="logo-container">
		<a href="dashboard.php" class="logo-link">
			<img src="images/nextgen_logo.png" alt="Logo" class="logo-img">
		</a>
	</div>

	<div class="menu-links">
		<?php echo $menu_content; ?>
	</div>

	<div class="profile-dropdown-container">
		<button class="profile-toggle-btn" data-toggle="dropdown" aria-expanded="false" title="VIEW">
			<img src="uplode/<?php echo $_SESSION['u_id'] . '.jpg'; ?>" class="profile-img" alt="User Image">
		</button>
		<div class="dropdown-menu-custom">
			<div class="user-header">
				<img src="uplode/<?php echo $_SESSION['u_id'] . '.jpg'; ?>" class="profile-img-large" alt="User Image">
				<div class="user-info">
					<p>
						<strong>Name:</strong> <?php echo htmlspecialchars($user_data['staff_fullname']); ?><br>
						<strong>Email:</strong> <?php echo htmlspecialchars($user_data['staff_email']); ?><br>
						<strong>Mobile:</strong> <?php echo htmlspecialchars($user_data['staff_contactno']); ?>
					</p>
				</div>
			</div>
			<div class="user-footer">
				<a href="profile.php" class="btn profile-btn">Profile</a>
				<a href="logout.php" class="btn logout-btn">LogOut</a>
			</div>
		</div>
	</div>
</div>